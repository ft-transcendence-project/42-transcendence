<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Documentation</title>
    <!-- OpenAPI/Swagger UI -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/5.11.0/swagger-ui.min.css">
    <!-- AsyncAPI UI -->
    <link href="https://unpkg.com/@asyncapi/react-component@1.0.0-next.48/styles/default.min.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 0;
        }
        .top-bar {
            background-color: #f8f9fa;
            padding: 1em;
            border-bottom: 1px solid #dee2e6;
            display: flex;
            justify-content: center;
            gap: 1em;
            position: sticky;
            top: 0;
            z-index: 1000;
            background-color: white;
            flex-wrap: wrap;
        }
        .viewer-select {
            width: 100%;
            display: flex;
            justify-content: center;
            gap: 1em;
        }
        .api-button {
            padding: 0.75em 1.5em;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            background-color: white;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        .api-button:hover {
            background-color: #f0f0f0;
        }
        .api-button.active {
            background-color: #49cc90;
            color: white;
            border-color: #49cc90;
        }
        #viewer-container {
            margin: 0;
            padding: 20px;
        }
        .error-message {
            padding: 1em;
            margin: 1em;
            background-color: #fff1f0;
            border: 1px solid #ffa39e;
            border-radius: 4px;
            color: #cf1322;
        }
        .swagger-ui .topbar {
            display: none;
        }
        .asyncapi__sidebar {
            position: sticky;
            top: 60px;
            height: calc(100vh - 60px);
        }
        #swagger-ui, #asyncapi {
            display: none;
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <div class="top-bar">
        <div class="viewer-select">
            <button class="api-button" id="openapi-button" onclick="switchViewer('openapi')">OpenAPI</button>
            <button class="api-button" id="asyncapi-button" onclick="switchViewer('asyncapi')">AsyncAPI</button>
        </div>
    </div>
    <div id="error-container"></div>
    <div id="viewer-container">
        <div id="swagger-ui"></div>
        <div id="asyncapi"></div>
    </div>

    <!-- OpenAPI/Swagger UI -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/5.11.0/swagger-ui-bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/swagger-ui/5.11.0/swagger-ui-standalone-preset.min.js"></script>
    <!-- AsyncAPI UI -->
    <script src="https://unpkg.com/@asyncapi/react-component@1.0.0-next.48/browser/standalone/index.js"></script>
    <!-- YAML Parser -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>
    
    <script>
        // API specifications configuration
        const specs = {
            openapi: {
                files: ['Accounts.yaml', 'OAuth.yaml', 'Tournament.yaml'],
                container: 'swagger-ui',
                buttonId: 'openapi-button'
            },
            asyncapi: {
                files: ['Gameplay.yaml'],
                container: 'asyncapi',
                buttonId: 'asyncapi-button'
            }
        };

        let swaggerUI = null;

        function showError(message) {
            const container = document.getElementById('error-container');
            container.innerHTML = `<div class="error-message">${message}</div>`;
        }

        function clearError() {
            document.getElementById('error-container').innerHTML = '';
        }

        async function switchViewer(viewerType) {
            clearError();

            // Update button states
            Object.values(specs).forEach(spec => {
                document.getElementById(spec.buttonId).classList.remove('active');
            });
            document.getElementById(specs[viewerType].buttonId).classList.add('active');

            // Hide all containers
            document.getElementById('swagger-ui').style.display = 'none';
            document.getElementById('asyncapi').style.display = 'none';

            // Show and initialize selected viewer
            const selectedSpec = specs[viewerType];
            document.getElementById(selectedSpec.container).style.display = 'block';

            if (viewerType === 'openapi') {
                await loadOpenAPISpecs();
            } else {
                await loadAsyncAPISpec();
            }
        }

        async function loadOpenAPISpecs() {
            try {
                const response = await fetch(specs.openapi.files[0]); // Load first file
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const yamlContent = await response.text();
                const spec = jsyaml.load(yamlContent);

                const container = document.getElementById('swagger-ui');
                container.innerHTML = '';

                swaggerUI = SwaggerUIBundle({
                    urls: specs.openapi.files.map(file => ({
                        url: file,
                        name: file.replace('.yaml', '')
                    })),
                    dom_id: '#swagger-ui',
                    deepLinking: true,
                    presets: [
                        SwaggerUIBundle.presets.apis,
                        SwaggerUIStandalonePreset
                    ],
                    plugins: [
                        SwaggerUIBundle.plugins.DownloadUrl
                    ],
                    defaultModelsExpandDepth: -1,
                    displayRequestDuration: true,
                    filter: false,
                    layout: "BaseLayout"
                });
            } catch (error) {
                console.error('Error loading OpenAPI specs:', error);
                showError(`Error loading OpenAPI specification: ${error.message}`);
            }
        }

        async function loadAsyncAPISpec() {
            try {
                const response = await fetch(specs.asyncapi.files[0]);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const yamlContent = await response.text();
                const spec = jsyaml.load(yamlContent);

                const container = document.getElementById('asyncapi');
                container.innerHTML = '';

                AsyncApiStandalone.render({
                    schema: spec,
                    config: {
                        show: {
                            sidebar: true,
                            info: true,
                            servers: true,
                            operations: true,
                            messages: true,
                            schemas: true,
                            errors: true
                        },
                        expand: {
                            operations: true,
                            messages: true,
                            schemas: true
                        },
                        maxWidth: '100%'
                    }
                }, container);
            } catch (error) {
                console.error('Error loading AsyncAPI spec:', error);
                showError(`Error loading AsyncAPI specification: ${error.message}`);
            }
        }

        // Initialize on page load
        window.onload = function() {
            // Check URL hash to determine initial viewer
            const hash = window.location.hash.substring(1);
            const initialViewer = (hash === 'asyncapi') ? 'asyncapi' : 'openapi';
            switchViewer(initialViewer);

            // Add hash change listener
            window.addEventListener('hashchange', () => {
                const newHash = window.location.hash.substring(1);
                if (newHash === 'asyncapi' || newHash === 'openapi') {
                    switchViewer(newHash);
                }
            });
        };
    </script>
</body>
</html>